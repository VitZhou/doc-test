# 鉴权接入

## 1、依赖

```xml
    <dependency>
        <groupId>com.chinasofti.futurelab.base.auth</groupId>
        <artifactId>auth-sdk</artifactId>
        <version>1.0-SNAPSHOT</version>
    </dependency>
```

## 2、使用

用aop的方式基于注解实现,提供@RoleRead,@RoleWrite等注解.这些注解只能加在controller的方法上.否则会失效

### 2.1、@RoleRead

读权限,只校验是否有token.

### 2.2、@RoleWrite

写权限,会校验token,以及timestamp,nonce.

### 获取userId

```java
Optional<String> userIdOptional = UserInfoHolder.userId();
```

例如:

```java
@RoleRead
@GetMapping("/{name}")
public ResponseObject<String> empty(@PathVariable String name){
    Optional<String> userIdOptional = UserInfoHolder.userId();
    return userIdOptional.map(ResponseObject::success).orElseGet(ResponseObject::success);
}
```

## userId说明

严禁从web,app传入userId. 因为这样会有被攻击的危险.

## 本地开发环境的测试

spring.cloud.profile设置为非'sit','uat','prod'值的话可以开启mock.在任意token的传入都可以调用成功。

如果token为真实的token,则userId会设置为真实userId,否则获取到的是个mock的id.